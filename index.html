<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëΩ ALIEN DECODER ¬∑ INSANE + LEXICON</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* (Same cosmic style as before ‚Äì keep it) */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #0a0f0f;
            font-family: 'Orbitron', sans-serif;
            color: #b7fff0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        body::before {
            content: "";
            position: fixed;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 30%, #b5ffe0 1px, transparent 1px),
                        radial-gradient(circle at 80% 70%, #b0f0ff 1px, transparent 1px);
            background-size: 80px 80px, 120px 120px;
            animation: drift 90s linear infinite;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }
        @keyframes drift {
            0% { transform: translate(0,0) rotate(0deg); }
            100% { transform: translate(-30%, -20%) rotate(3deg); }
        }
        .ufo {
            position: absolute;
            top: 30px;
            left: -200px;
            font-size: 3.5rem;
            filter: drop-shadow(0 0 8px #0ff);
            animation: fly 24s linear infinite;
            z-index: 5;
        }
        .ufo2 {
            position: absolute;
            bottom: 100px;
            left: -300px;
            font-size: 2.8rem;
            filter: drop-shadow(0 0 5px #ffb3ff);
            animation: fly 31s linear reverse infinite;
            z-index: 5;
        }
        @keyframes fly {
            0% { left: -200px; transform: scale(0.8); }
            20% { transform: scale(1.2); }
            50% { top: 15vh; transform: scale(1); }
            100% { left: 120%; transform: scale(0.7); }
        }
        .game-container {
            position: relative;
            z-index: 20;
            max-width: 1100px;
            margin: 30px auto;
            background: rgba(8, 20, 18, 0.9);
            backdrop-filter: blur(4px);
            border: 2px solid #1effd0;
            border-radius: 32px;
            padding: 30px;
            box-shadow: 0 0 40px #1effd0, inset 0 0 20px #1a4d47;
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 20px;
        }
        .mission-panel {
            background: #031010c9;
            border-radius: 24px;
            padding: 20px;
            border: 1px solid #2affbf;
        }
        .glitch {
            font-size: 1.8rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin: 20px 0;
            animation: glitch 2.2s infinite;
            word-break: break-word;
        }
        @keyframes glitch {
            0% { text-shadow: 3px 0 #ff00c1, -2px 0 #00ffea; }
            25% { text-shadow: -4px 0 #ff6600, 2px 0 cyan; }
            50% { text-shadow: 2px 2px magenta, -2px -2px lime; }
            75% { text-shadow: -3px 2px blue, 3px -2px red; }
            100% { text-shadow: 2px 0 #00ffc3, -2px 0 #ff00e6; }
        }
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 25px 0;
        }
        .options-grid button {
            background: transparent;
            border: 2px solid #2affbf;
            border-radius: 60px;
            padding: 14px 20px;
            font-family: 'Orbitron', sans-serif;
            color: #d5fffb;
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.2s;
            text-align: left;
            position: relative;
        }
        .options-grid button:hover:not(:disabled) {
            background: #1effd0;
            color: #031010;
            border-color: #f0f;
            box-shadow: 0 0 20px #f0f;
            transform: scale(1.02);
        }
        .correct {
            background: #00d4a0 !important;
            color: #000 !important;
            border-color: #ffff !important;
        }
        .correct::after {
            content: " ‚úì";
            font-size: 1.5rem;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        .wrong {
            background: #b41e5c !important;
            color: black !important;
            border-color: #ff99cc !important;
            text-decoration: line-through wavy #fff;
        }
        .hint-area {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .hint-btn {
            background: #160f2b;
            border: 2px dashed #fe0;
            border-radius: 40px;
            padding: 12px 28px;
            font-weight: bold;
            color: #fffdab;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
            flex: 1;
        }
        .hint-btn:hover:not(:disabled) {
            background: #fffd9f;
            color: black;
            border-color: magenta;
            box-shadow: 0 0 30px yellow;
        }
        #hintBox {
            background: #0f2b28;
            border-radius: 24px;
            padding: 15px 20px;
            font-size: 1.2rem;
            border-left: 10px solid #fe0;
            margin: 10px 0;
            color: #fffbbc;
            transition: opacity 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            margin-top: 25px;
            border-top: 2px solid #0ff;
            padding-top: 15px;
        }
        .data-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .lexicon-panel, .leaderboard-panel {
            background: #0b1d1a;
            border: 2px solid #bcfffd;
            border-radius: 28px;
            padding: 20px 15px;
        }
        .lexicon-panel h2, .leaderboard-panel h2 {
            font-size: 1.5rem;
            color: #fbffa3;
            border-bottom: 2px solid #78ffe0;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }
        #lexiconList {
            max-height: 220px;
            overflow-y: auto;
            font-size: 1.0rem;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .lex-item {
            background: #17302b;
            border-radius: 40px;
            padding: 8px 15px;
            border: 1px solid #0ff;
            display: flex;
            justify-content: space-between;
        }
        .lex-alien { font-weight: bold; color: #ffbc6e; }
        .lex-human { color: #b3ffe0; font-style: italic; }
        #leaderboardList {
            list-style: none;
            font-size: 1.2rem;
        }
        #leaderboardList li {
            padding: 6px 10px;
            border-bottom: 1px solid #49c6b3;
            display: flex;
            justify-content: space-between;
        }
        #leaderboardList li::before {
            content: "üëæ";
            margin-right: 10px;
        }
        .reset-btn {
            background: transparent;
            border: 2px solid #ff4de1;
            color: #ffb3fd;
            border-radius: 40px;
            padding: 8px 15px;
            margin-top: 15px;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
        }
        .reset-btn:hover {
            background: #ff6ef0;
            color: black;
        }
        .alien-win {
            font-size: 2.5rem;
            text-align: center;
            color: #f0f;
            text-shadow: 0 0 30px cyan;
            animation: glitch 1s infinite;
            margin: 30px 0;
        }
        .correct-message {
            background: #0f0;
            color: black;
            font-weight: bold;
            padding: 8px;
            border-radius: 50px;
            margin: 5px 0;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="ufo">üõ∏üëΩüõ∏</div>
<div class="ufo2">üõ∏üî¶üëæ</div>

<div class="game-container" id="mainGameContainer">
    <div class="mission-panel" id="missionPanel">
        <h1 style="font-size: 2rem;">‚ó§ ALIEN DECODER ‚ó¢</h1>
        <div id="alienText" class="glitch">...</div>
        <div id="options" class="options-grid"></div>
        <div class="hint-area">
            <button class="hint-btn" id="hintButton" onclick="useHint()">üí° DECODE HINT</button>
            <span style="background:#000; padding:10px; border-radius:50px;" id="hintCount">üß™ 2</span>
        </div>
        <div id="hintBox">üëΩ‚Äî press hint to decrypt ‚Äî</div>
        <div class="stats">
            <span id="score">üî∞ SCORE: 0</span>
            <span id="questionsLeft">üì° LEFT: 16</span>
        </div>
        <button class="reset-btn" onclick="resetGame()">‚ü≤ RESTART MISSION ‚ü≤</button>
    </div>

    <div class="data-panel">
        <div class="lexicon-panel">
            <h2>üìñ ALIEN LEXICON</h2>
            <div id="lexiconList">‚Äî decode to reveal ‚Äî</div>
        </div>
        <div class="leaderboard-panel">
            <h2>üèÜ COSMIC LEADERBOARD</h2>
            <ol id="leaderboardList">loading from galaxy...</ol>
            <div style="font-size:0.8rem;">top 10 ¬∑ GAS sync (JSONP)</div>
        </div>
    </div>
</div>

<audio id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.wav"></audio>
<audio id="wrongSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-changing-tab-206.wav"></audio>

<script>
    // ================= CONFIG =================
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwLdsXN40Bzf68l2eloIiZs3Vk_OwQERJdqMbsGVm0uGz4N-3jfKmlZD9tFlTEOUfTSvQ/exec";  // <-- REPLACE WITH YOUR GAS URL

    // Expanded lexicon and more complex sentences (16 total)
    const lexiconDB = {
        "Zyra'k": "we", "tul": "come", "venar": "peace",
        "Kora": "ship", "xyn": "has/have", "talor": "landed",
        "Velan": "prepare", "torix": "for", "za": "departure",
        "Xenar": "energy", "vol": "levels/are", "ti'ra": "rising",
        "Tor": "activate", "venak": "shield", "zil": "now",
        "Nefar": "danger", "kros": "alien", "mek": "must",
        "vorta": "return", "lyss": "moon", "bor": "base",
        "zynth": "secret", "orok": "code", "vix": "crystal",
        "morph": "change", "quantum": "dimension"
    };

    const questions = [
        { alien: "Zyra'k tul venar", answer: "We come peace" },
        { alien: "Kora xyn talor", answer: "Ship has landed" },
        { alien: "Velan torix za", answer: "Prepare for departure" },
        { alien: "Xenar vol ti'ra", answer: "Energy levels rising" },
        { alien: "Tor venak zil", answer: "Activate shield now" },
        { alien: "Nefar kros mek vorta", answer: "Danger alien must return" },
        { alien: "Zyra'k vol lyss bor", answer: "We are moon base" },
        { alien: "Kora torix venak", answer: "Ship for shield" },
        { alien: "Xenar bor ti'ra", answer: "Energy base rising" },
        { alien: "Venak tul kros", answer: "Shield come alien" },
        { alien: "Lyss bor mek za", answer: "Moon base must departure" },
        { alien: "Velan vorta zil", answer: "Prepare return now" },
        { alien: "Zynth orok vix", answer: "Secret code crystal" },
        { alien: "Morph quantum xenar", answer: "Change dimension energy" },
        { alien: "Nefar bor ti'ra", answer: "Danger base rising" },
        { alien: "Zyra'k mek venak", answer: "We must shield" }
    ];

    // ---------- Game state ----------
    let score = 0;
    let hintsLeft = 2;                 // only 2 hints ‚Äì more difficult
    let usedIndexes = JSON.parse(localStorage.getItem("usedQuestions")) || [];
    let currentQuestionIndex = null;
    let discoveredWords = JSON.parse(localStorage.getItem("alienLexicon")) || {};

    // ---------- Helper functions ----------
    function saveLexicon() {
        localStorage.setItem("alienLexicon", JSON.stringify(discoveredWords));
        renderLexicon();
    }

    function addWordToLexicon(alienWord, translation) {
        if (!discoveredWords[alienWord] && translation) {
            discoveredWords[alienWord] = translation;
        }
    }

    function learnCurrentSentence() {
        if (currentQuestionIndex === null) return;
        const alienWords = questions[currentQuestionIndex].alien.split(' ');
        alienWords.forEach(aw => {
            if (lexiconDB[aw]) addWordToLexicon(aw, lexiconDB[aw]);
        });
        saveLexicon();
    }

    function renderLexicon() {
        const container = document.getElementById('lexiconList');
        if (!container) return;
        const entries = Object.entries(discoveredWords);
        if (entries.length === 0) {
            container.innerHTML = '<div style="color:#6f9f9a;">üëΩ‚Äî decode to reveal ‚Äî</div>';
            return;
        }
        container.innerHTML = entries.map(([alien, human]) => 
            `<div class="lex-item"><span class="lex-alien">${alien}</span> <span class="lex-human">‚á¢ ${human}</span></div>`
        ).join('');
    }

    // ---------- Leaderboard (CORS‚Äëproof) ----------
    function fetchLeaderboard() {
        // Use JSONP to bypass CORS
        const script = document.createElement('script');
        const callbackName = 'jsonp_callback_' + Date.now();
        window[callbackName] = function(data) {
            const listEl = document.getElementById('leaderboardList');
            if (!listEl) return;
            if (!data || data.length === 0) {
                listEl.innerHTML = '<li style="color:gray;">no scores yet</li>';
            } else {
                listEl.innerHTML = data.map(entry => 
                    `<li><span>${entry.name}</span> <span style="color:#fbffb3;">${entry.score}</span></li>`
                ).join('');
            }
            delete window[callbackName];
            document.body.removeChild(script);
        };
        script.src = `${GAS_URL}?callback=${callbackName}`;
        document.body.appendChild(script);
    }

    async function submitScore(playerName, finalScore) {
        // Use no-cors mode ‚Äì request will be sent, but we can't read response
        try {
            await fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',           // bypass CORS
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: playerName, score: finalScore })
            });
            // Still try to refresh leaderboard after a short delay
            setTimeout(fetchLeaderboard, 2000);
        } catch (e) {
            console.warn('Score submission failed (no-cors used, might still work)');
        }
    }

    // ---------- Game mechanics ----------
    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    function updateLeftCount() {
        const left = questions.length - usedIndexes.length;
        document.getElementById('questionsLeft').innerText = `üì° LEFT: ${left}`;
        return left;
    }

    function showAlienWinMessage() {
        const panel = document.getElementById('missionPanel');
        panel.innerHTML = `
            <div class="alien-win">üëæ‚ó§ VICTORY ‚ó¢üëæ</div>
            <div style="font-size:2rem; text-align:center;">FINAL SCORE: ${score}</div>
            <div style="margin:30px 0; font-size:1.4rem; color:#ff0;">‚ÄúZyra'k tul venar‚Äù ‚Äî you are peace</div>
            <button class="reset-btn" onclick="resetGame()">‚ü≤ PLAY AGAIN ‚ü≤</button>
        `;
    }

    function gameComplete() {
        const playerName = prompt("üëæ MISSION COMPLETE! Enter your name for the leaderboard:", "Explorer");
        submitScore(playerName ? playerName.trim() || "Anonymous" : "Anonymous", score);
        showAlienWinMessage();
    }

    function getRandomQuestion() {
        if (usedIndexes.length >= questions.length) {
            gameComplete();
            return;
        }

        let idx;
        do {
            idx = Math.floor(Math.random() * questions.length);
        } while (usedIndexes.includes(idx));

        currentQuestionIndex = idx;
        usedIndexes.push(idx);
        localStorage.setItem("usedQuestions", JSON.stringify(usedIndexes));
        showQuestion();
        updateLeftCount();
    }

    function showQuestion() {
        document.getElementById("hintBox").innerText = "üëΩ‚Äî press hint to decrypt ‚Äî";
        const q = questions[currentQuestionIndex];
        document.getElementById("alienText").innerText = q.alien;

        // Generate 5 options (1 correct, 4 random) ‚Äì harder
        let otherAnswers = questions.map(q => q.answer).filter(a => a !== q.answer);
        otherAnswers = shuffle(otherAnswers).slice(0, 4);
        let options = [q.answer, ...otherAnswers];
        options = shuffle(options);

        const optionsDiv = document.getElementById("options");
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement("button");
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt);
            optionsDiv.appendChild(btn);
        });
        document.getElementById("hintCount").innerText = `üß™ ${hintsLeft}`;
        document.getElementById("hintButton").disabled = (hintsLeft === 0);
    }

    function checkAnswer(btn, selected) {
        const correct = questions[currentQuestionIndex].answer;
        const allBtns = document.querySelectorAll("#options button");
        allBtns.forEach(b => b.disabled = true);

        if (selected === correct) {
            btn.classList.add("correct");
            score++;
            document.getElementById("correctSound").play();
            learnCurrentSentence();
            // Show a floating correct sign (optional)
            const msg = document.createElement("div");
            msg.className = "correct-message";
            msg.innerText = "‚úî CORRECT!";
            document.getElementById("hintBox").innerHTML = ""; // clear hint
            document.getElementById("hintBox").appendChild(msg);
            setTimeout(() => {
                if (document.getElementById("hintBox").contains(msg))
                    document.getElementById("hintBox").innerHTML = "üëΩ‚Äî press hint to decrypt ‚Äî";
            }, 1500);
        } else {
            btn.classList.add("wrong");
            document.getElementById("wrongSound").play();
            allBtns.forEach(b => {
                if (b.innerText === correct) b.classList.add("correct");
            });
        }
        document.getElementById("score").innerText = "üî∞ SCORE: " + score;

        setTimeout(() => {
            if (usedIndexes.length < questions.length) getRandomQuestion();
            else gameComplete();
        }, 2000);
    }

    function useHint() {
        if (hintsLeft <= 0 || currentQuestionIndex === null) {
            document.getElementById("hintBox").innerText = "‚ùå no hints left!";
            setTimeout(() => {
                if (document.getElementById("hintBox").innerText === "‚ùå no hints left!")
                    document.getElementById("hintBox").innerText = "üëΩ‚Äî press hint to decrypt ‚Äî";
            }, 3000);
            return;
        }
        const q = questions[currentQuestionIndex];
        const alienWords = q.alien.split(' ');
        const unknown = alienWords.filter(w => !discoveredWords[w] && lexiconDB[w]);
        if (unknown.length === 0) {
            document.getElementById("hintBox").innerText = `üîç translation: ${q.answer.length} chars, starts with '${q.answer[0]}'`;
        } else {
            const randomWord = unknown[Math.floor(Math.random() * unknown.length)];
            const meaning = lexiconDB[randomWord] || '?';
            addWordToLexicon(randomWord, meaning);
            saveLexicon();
            document.getElementById("hintBox").innerHTML = `üß© <strong>${randomWord}</strong> ‚á¢ ${meaning}`;
        }
        hintsLeft--;
        document.getElementById("hintCount").innerText = `üß™ ${hintsLeft}`;
        if (hintsLeft === 0) document.getElementById("hintButton").disabled = true;

        // Hint disappears after 5 seconds
        setTimeout(() => {
            document.getElementById("hintBox").innerHTML = "üëΩ‚Äî press hint to decrypt ‚Äî";
        }, 5000);
    }

    function resetGame() {
        localStorage.removeItem("usedQuestions");
        localStorage.removeItem("alienLexicon");
        usedIndexes = [];
        discoveredWords = {};
        score = 0;
        hintsLeft = 2;
        currentQuestionIndex = null;
        document.getElementById('missionPanel').innerHTML = `
            <h1 style="font-size: 2rem;">‚ó§ ALIEN DECODER ‚ó¢</h1>
            <div id="alienText" class="glitch">...</div>
            <div id="options" class="options-grid"></div>
            <div class="hint-area">
                <button class="hint-btn" id="hintButton" onclick="useHint()">üí° DECODE HINT</button>
                <span style="background:#000; padding:10px; border-radius:50px;" id="hintCount">üß™ 2</span>
            </div>
            <div id="hintBox">üëΩ‚Äî press hint to decrypt ‚Äî</div>
            <div class="stats">
                <span id="score">üî∞ SCORE: 0</span>
                <span id="questionsLeft">üì° LEFT: 16</span>
            </div>
            <button class="reset-btn" onclick="resetGame()">‚ü≤ RESTART MISSION ‚ü≤</button>
        `;
        renderLexicon();
        getRandomQuestion();
        updateLeftCount();
    }

    // ---------- Initialisation ----------
    fetchLeaderboard();
    renderLexicon();
    if (usedIndexes.length >= questions.length) {
        resetGame();
    } else {
        getRandomQuestion();
    }
    setInterval(fetchLeaderboard, 30000); // refresh leaderboard every 30s
</script>
</body>
</html>